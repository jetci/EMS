<!DOCTYPE html>
<html>
<head>
    <title>Test Profile Save</title>
</head>
<body>
    <h1>Test Profile Image Save</h1>
    <button onclick="testProfileSave()">Test Save Profile</button>
    <pre id="result"></pre>

    <script>
        async function testProfileSave() {
            const token = localStorage.getItem('wecare_token');
            const resultEl = document.getElementById('result');
            
            if (!token) {
                resultEl.textContent = 'Error: No token found. Please login first.';
                return;
            }

            resultEl.textContent = 'Testing...\n';

            // Small test image (1x1 pixel PNG)
            const testImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';

            const payload = {
                name: 'Test User',
                phone: '0812345678',
                profileImageUrl: testImage
            };

            try {
                resultEl.textContent += 'Sending request...\n';
                resultEl.textContent += 'Token: ' + token.substring(0, 20) + '...\n';
                resultEl.textContent += 'Payload size: ' + JSON.stringify(payload).length + ' bytes\n\n';

                const response = await fetch('/api/auth/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                resultEl.textContent += 'Response Status: ' + response.status + ' ' + response.statusText + '\n';
                resultEl.textContent += 'Response Headers:\n';
                for (let [key, value] of response.headers.entries()) {
                    resultEl.textContent += '  ' + key + ': ' + value + '\n';
                }
                resultEl.textContent += '\n';

                const text = await response.text();
                resultEl.textContent += 'Response Body:\n' + text + '\n\n';

                if (response.ok) {
                    const data = JSON.parse(text);
                    resultEl.textContent += 'SUCCESS!\n';
                    resultEl.textContent += 'User ID: ' + data.id + '\n';
                    resultEl.textContent += 'Name: ' + data.name + '\n';
                    resultEl.textContent += 'Has profileImageUrl: ' + (!!data.profileImageUrl) + '\n';
                } else {
                    resultEl.textContent += 'FAILED!\n';
                    resultEl.textContent += 'Error: ' + text + '\n';
                }
            } catch (error) {
                resultEl.textContent += 'ERROR: ' + error.message + '\n';
                console.error('Test error:', error);
            }
        }
    </script>
</body>
</html>
