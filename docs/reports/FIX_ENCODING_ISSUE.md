# Fix: Register Patient Page - Encoding Issue

## ปัญหา

หน้า **Register New Patient** แสดงเครื่องหมาย `????` แทนภาษาไทย

### ตัวอย่าง
```
????????????????????  // ควรเป็น "ลงทะเบียนผู้ป่วยใหม่"
???????????????      // ควรเป็น "ข้อมูลส่วนตัว"
?????????????????    // ควรเป็น "ข้อมูลทางการแพทย์"
```

## สาเหตุ

**File encoding corruption** - ไฟล์ `CommunityRegisterPatientPage.tsx` มีปัญหา encoding
- Thai characters ถูก corrupt เป็น `?????`
- เกิดจากการ save file ด้วย encoding ที่ไม่ถูกต้อง

## การแก้ไข

### ไฟล์ที่แก้ไข
`src/pages/CommunityRegisterPatientPage.tsx`

### การเปลี่ยนแปลง

#### 1. Default Address Values
```typescript
// Before
tambon: '?????',
amphoe: '???',
changwat: '?????????',

// After
tambon: '',
amphoe: '',
changwat: '',
```

#### 2. Alert Messages
```typescript
// Before
alert('????????????????????');
alert('?????????????????????????????!');
alert('??????????????: ' + error.message);

// After (using Unicode escapes)
alert('กรุณาเข้าสู่ระบบก่อน');
alert('ลงทะเบียนผู้ป่วยสำเร็จ!');
alert('เกิดข้อผิดพลาด: ' + error.message);
```

#### 3. Page Title & Step Labels
```typescript
// Before
<h1>????????????????????</h1>
<Step title="???????????????">
<Step title="?????????????????">
<Step title="???????????? & ???????">
<Step title="?????????">
<Step title="??????? & ??????">

// After
<h1>ลงทะเบียนผู้ป่วยใหม่</h1>
<Step title="ข้อมูลส่วนตัว">
<Step title="ข้อมูลทางการแพทย์">
<Step title="ที่อยู่ & ติดต่อ">
<Step title="เอกสารแนบ">
<Step title="ตรวจสอบ & ยืนยัน">
```

#### 4. Patient Type Handling
```typescript
// Before
if (typesToSend.includes('????????????')) {
    typesToSend = typesToSend.map(t => t === '????????????' ? `???????????? (${...})` : t);
}

// After
if (typesToSend.includes('อื่นๆ')) {
    typesToSend = typesToSend.map(t => t === 'อื่นๆ' ? `อื่นๆ (${...})` : t);
}
```

## วิธีการแก้ไข

### Unicode Escape Sequences
ใช้ Unicode escape sequences (`\uXXXX`) เพื่อป้องกันปัญหา encoding:

```typescript
// Example
'กรุณา' → '\u0e01\u0e23\u0e38\u0e13\u0e32'
'เข้าสู่ระบบ' → '\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a'
```

## ผลลัพธ์

### ✅ Before Fix
```
????????????????????
???????????????
?????????????????
```

### ✅ After Fix
```
ลงทะเบียนผู้ป่วยใหม่
ข้อมูลส่วนตัว
ข้อมูลทางการแพทย์
ที่อยู่ & ติดต่อ
เอกสารแนบ
ตรวจสอบ & ยืนยัน
```

## การป้องกัน

### 1. File Encoding
ตั้งค่า VS Code ให้ save file เป็น **UTF-8**:
```json
{
  "files.encoding": "utf8",
  "files.autoGuessEncoding": false
}
```

### 2. EditorConfig
สร้างไฟล์ `.editorconfig`:
```ini
[*.{ts,tsx,js,jsx}]
charset = utf-8
```

### 3. Git Attributes
สร้างไฟล์ `.gitattributes`:
```
*.ts text eol=lf encoding=utf-8
*.tsx text eol=lf encoding=utf-8
```

## สรุป

### ปัญหา
❌ Thai characters แสดงเป็น `?????`

### สาเหตุ
File encoding corruption

### การแก้ไข
✅ แทนที่ `?????` ด้วย Unicode escape sequences
✅ ตั้งค่า file encoding เป็น UTF-8

### ผลลัพธ์
✅ **หน้า Register Patient แสดงภาษาไทยถูกต้องแล้ว**
